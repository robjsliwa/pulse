# Pulse

Live polls & reactions service in Go with REST CRUD, SSE result streaming, signed webhooks, and autogenerated Swagger docs.

[![CI](https://github.com/robjsliwa/pulse/actions/workflows/ci.yml/badge.svg?branch=main)](https://github.com/robjsliwa/pulse/actions/workflows/ci.yml)
[![Swagger](https://img.shields.io/badge/swagger-openapi-blue?logo=swagger)](docs/swagger.yaml)

## Features
- Hexagonal architecture (ports/adapters)
- GORM + SQLite persistence (`./pulse.db`)
- REST: Polls, Options, Votes (CRUD-ish)
- SSE: `GET /polls/:id/results/stream`
- Webhooks: `vote.created`, `poll.threshold_reached`, `poll.closed` with `Pulse-Signature` (HMAC-SHA256)
- Swagger UI at `/swagger/index.html`

## Quickstart

1) Install tools and deps

```
go mod tidy
```

2) Run the service

```
go run ./cmd/pulse
```

3) Explore the API docs

- Swagger UI: http://localhost:${PORT:-8080}/swagger/index.html

## Configuration

Environment variables:

- `PORT` — HTTP port (default `8080`)
- `DB_PATH` — SQLite file path (default `./pulse.db`)
- `CORS_ORIGINS` — CSV allowlist or `*` (default `*`)
- `WEBHOOK_MAX_RETRIES` — max retries for webhook dispatcher (default `5`)
- `WEBHOOK_TARGETS` — optional CSV of webhook target URLs
- `WEBHOOK_SECRET` — optional HMAC secret for `Pulse-Signature`

## Architecture

- `domain/` — pure entities and value types
- `app/` — use cases/services, ports for repo/stream/webhook
- `adapters/http` — Gin handlers + DTOs + SSE broadcaster
- `adapters/persistence` — GORM repo + models
- `internal/webhook` — signed webhook dispatcher with backoff
- `data/` — DB open + AutoMigrate
- `cmd/pulse` — main wiring, routes, middleware, Swagger

## Security & Ops

- Request ID middleware
- CORS allowlist via env
- Payload size limits
- SSE no-cache + keepalive heartbeats
- Never log secrets (webhook secret not logged)

